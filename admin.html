<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard ‚Äî Borodina.Pilates</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'JetBrains Mono', monospace; padding: 20px; margin: 0; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #30363d; padding-bottom: 20px; }
        h1 { font-size: 1.5rem; margin: 0; color: #58a6ff; }
        .status-badge { background: #238636; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        /* Cards */
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 20px; }
        .card h2 { font-size: 1rem; margin-top: 0; color: #8b949e; text-transform: uppercase; letter-spacing: 1px; }
        
        .big-number { font-size: 2.5rem; font-weight: bold; color: #f0f6fc; margin: 10px 0; }
        .sub-text { font-size: 0.85rem; color: #8b949e; }
        
        /* Money Color */
        .money { color: #3fb950; }
        
        /* Table for Ghosts */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        th { text-align: left; color: #8b949e; padding-bottom: 10px; border-bottom: 1px solid #30363d; }
        td { padding: 10px 0; border-bottom: 1px solid #21262d; }
        
        .danger { color: #f85149; font-weight: bold; }
        .ok { color: #238636; }
        
        /* Refresh Button */
        .btn-refresh {
            background: #1f6feb; color: white; border: none; padding: 10px 20px; 
            border-radius: 6px; cursor: pointer; font-family: inherit; margin-top: 30px; width: 100%;
        }
        .btn-refresh:hover { background: #388bfd;
        .warning { color: #ffab00; } /* –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è '–Ω–µ –¥–æ—à–µ–¥—à–∏—Ö' */
         }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>PILATES_PROJECT_CONTROL</h1>
        <div class="status-badge" id="system-status">CONNECTING...</div>
    </header>

    <div class="grid">
        
        <!-- –ë–ª–æ–∫ –§–∏–Ω–∞–Ω—Å—ã -->
        <div class="card">
            <h2>üí∞ Finance (MRR)</h2>
            <div class="big-number money" id="mrr-val">-</div>
            <div class="sub-text">–ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏ –æ—Ç —Ç–µ–∫—É—â–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</div>
            <div style="margin-top: 15px; font-size: 1.2rem;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: <span id="active-val" style="color:#fff">-</span></div>
        </div>

        <!-- –ë–ª–æ–∫ –¢—Ä–∞—Ñ–∏–∫ -->
        <div class="card">
            <h2>üåê Web Traffic</h2>
            <div class="big-number" id="traffic-today">-</div>
            <div class="sub-text">–í–∏–∑–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
            <div style="margin-top: 15px; color: #ffa657;">–û—à–∏–±–æ–∫ JS: 0</div>
        </div>

        <!-- –ë–ª–æ–∫ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
        <div class="card">
            <h2>üõ° Security</h2>
            <div class="big-number" style="color: #f85149;" id="banned-val">-</div>
            <div class="sub-text">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π</div>
        </div>

        <!-- –ë–ª–æ–∫ –î–µ—Ç–µ–∫—Ç–æ—Ä –ó–∞–π—Ü–µ–≤ -->
        <div class="card" style="grid-column: 1 / -1;">
            <h2>üëª Ghost Detector (–°–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤)</h2>
            <table>
                <thead>
                    <tr>
                        <th>–ö–∞–Ω–∞–ª</th>
                        <th>–ë–∞–∑–∞ (–û–ø–ª–∞—á–µ–Ω–æ)</th>
                        <th>Telegram (–§–∞–∫—Ç)</th>
                        <th>–†–∞–∑–Ω–∏—Ü–∞</th>
                    </tr>
                </thead>
                <tbody id="ghost-table">
                    <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                </tbody>
            </table>
        </div>

    </div>

    <button class="btn-refresh" onclick="loadData()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
</div>

<script>
    const API_URL = 'https://n8n.borodin.live/webhook/admin-stats';

    async function loadData() {
        document.getElementById('system-status').innerText = 'UPDATING...';
        document.getElementById('system-status').style.background = '#9e6a03';

        try {
            const res = await fetch(API_URL);
            const data = await res.json();

            // 1. –§–∏–Ω–∞–Ω—Å—ã
            document.getElementById('mrr-val').innerText = new Intl.NumberFormat('ru-RU').format(data.finance.mrr) + ' ‚Ç∏';
            document.getElementById('active-val').innerText = data.finance.active_total;

            // 2. –¢—Ä–∞—Ñ–∏–∫
            document.getElementById('traffic-today').innerText = data.traffic.today;

            // 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
            document.getElementById('banned-val').innerText = data.security.banned;

            // 4. –î–µ—Ç–µ–∫—Ç–æ—Ä –∑–∞–π—Ü–µ–≤ (–¢–∞–±–ª–∏—Ü–∞)
            // 4. –î–µ—Ç–µ–∫—Ç–æ—Ä –∑–∞–π—Ü–µ–≤ (–¢–∞–±–ª–∏—Ü–∞)
            const ghostData = data.ghosts;
            const levels = ['beginner', 'intermediate', 'advance'];
            const names = {'beginner': '–ù–∞—á–∞–ª—å–Ω—ã–π', 'intermediate': '–°—Ä–µ–¥–Ω–∏–π', 'advance': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'};
            
            let html = '';
            
            levels.forEach(lvl => {
                const row = ghostData[lvl];
                
                // –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
                let statusClass = '';
                let statusText = '';
                
                if (row.diff > 0) {
                    // –õ—é–¥–µ–π –±–æ–ª—å—à–µ, —á–µ–º –æ–ø–ª–∞—Ç -> –ó–ê–ô–¶–´
                    statusClass = 'danger'; // –ö—Ä–∞—Å–Ω—ã–π
                    statusText = `üö® +${row.diff} (–õ–∏—à–Ω–∏–µ)`;
                } else if (row.diff < 0) {
                    // –õ—é–¥–µ–π –º–µ–Ω—å—à–µ, —á–µ–º –æ–ø–ª–∞—Ç -> –ö–¢–û-–¢–û –ù–ï –í–°–¢–£–ü–ò–õ
                    statusClass = 'warning'; // –ñ–µ–ª—Ç—ã–π (–Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ CSS)
                    statusText = `üí§ ${row.diff} (–ù–µ –¥–æ—à–ª–∏)`;
                } else {
                    // –ò–¥–µ–∞–ª—å–Ω–æ —Ä–æ–≤–Ω–æ
                    statusClass = 'ok'; // –ó–µ–ª–µ–Ω—ã–π
                    statusText = '‚úÖ OK';
                }

                // –í –∫–æ–ª–æ–Ω–∫–µ "–§–∞–∫—Ç" –ø–æ–∫–∞–∑—ã–≤–∞–µ–º: "5 (3 —á–µ–ª)" - –æ–±—â–µ–µ –∏ —Ä–µ–∞–ª—å–Ω–æ–µ
                html += `
                    <tr>
                        <td>${names[lvl]}</td>
                        <td>${row.db}</td>
                        <td title="–í—Å–µ–≥–æ: ${row.tg}, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö: ${row.tg - row.real_humans}">${row.tg} (${row.real_humans} —á–µ–ª)</td>
                        <td class="${statusClass}">${statusText}</td>
                    </tr>
                `;
            });
            document.getElementById('ghost-table').innerHTML = html;
            // –°—Ç–∞—Ç—É—Å
            document.getElementById('system-status').innerText = 'ONLINE';
            document.getElementById('system-status').style.background = '#238636';

        } catch (e) {
            console.error(e);
            document.getElementById('system-status').innerText = 'ERROR';
            document.getElementById('system-status').style.background = '#f85149';
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ n8n.');
        }
    }

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
    loadData();
</script>

</body>
</html>